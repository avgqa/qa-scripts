
<html>
   <head>
      <style type="text/css">
         .sikuli-code {
            font-size: 20px;
            font-family: "Osaka-mono", Monospace;
            line-height: 1.5em;
            display:table-cell;
            white-space: pre-wrap;       /* css-3 */
            white-space: -moz-pre-wrap !important;  /* Mozilla, since 1999 */
            white-space: -pre-wrap;      /* Opera 4-6 */
            white-space: -o-pre-wrap;    /* Opera 7 */
            word-wrap: break-word;       /* Internet Explorer 5.5+ */
            width: 99%;   /* remove horizontal scroll-bar when viewing in IE7 */
         }
         .sikuli-code img {
            vertical-align: middle;
            margin: 2px;
            border: 1px solid #ccc;
            padding: 2px;
            -moz-border-radius: 5px;
            -webkit-border-radius: 5px;
            -moz-box-shadow: 1px 1px 1px gray;
            -webkit-box-shadow: 1px 1px 2px gray;
         }
         .kw {
            color: blue;
         }
         .skw {
            color: rgb(63, 127, 127);
         }

         .str {
            color: rgb(128, 0, 0);
         }

         .dig {
            color: rgb(128, 64, 0);
         }

         .cmt {
            color: rgb(200, 0, 200);
         }

         h2 {
            display: inline;
            font-weight: normal;
         }

         .info {
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            margin-bottom: 20px;
            display: none;
         }

         a {
            color: #9D2900;
         }

         body {
            font-family: "Trebuchet MS", Arial, Sans-Serif;
         }

      </style>
   </head>
<body>
<div class="info">
<h2>PF_common_FF.sikuli\PF_common.sikuli</h2> <a href="PF_common_FF.sikuli\PF_common.zip">(Download this script)</a>
</div>
<pre class="sikuli-code">
<span class="kw">from</span> __future__ <span class="kw">import</span> with_statement
<span class="kw">import</span> ConfigParser
<span class="kw">import</span> logging
<span class="kw">from</span> sikuli <span class="kw">import</span> *
<span class="kw">import</span> os, re
<span class="kw">from</span> datetime <span class="kw">import</span> datetime


_passed_link = <img src="dl.dropboxusercontent.com/u/40284694/passed.png" />
_failed_link =<img src="dl.dropboxusercontent.com/u/40284694/failed.png" />
_chrome_appx86=<span class="str">"C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe"</span>
_chrome_app=<span class="str">"C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe"</span>
_install_link = <span class="str">"https://stage.privacyfix.com/start/install"</span>
_PF_link=<span class="str">"https://stage.privacyfix.com/start/"</span>
_ch1=(<img src="1387227872882.png" />)
_ch2=(<img src="1387230266787.png" />)
_PF_logo=<img src="1387925221847.png" />
<span class="cmt">#_email = _config.get('Test_account', 'email1') 
</span><span class="cmt">#_password = _config.get('Test_account', 'pass1') 
</span>
_rootDir = os.path.dirname(sys.argv[<span class="dig">0</span>].replace(<span class="str">"/"</span>, <span class="str">"\\"</span>))

<span class="kw">if</span> <span class="str">".sikuli"</span> <span class="kw">in</span> os.path.basename(_rootDir):
    <span class="cmt"># Running in command line returns the path including the sikuli script, different from IDE
</span>    _rootDir = os.path.dirname(_rootDir)
_rootDir = _rootDir + <span class="str">"\\"</span>
<span class="cmt">#_rootDir = "W:\\scripts\\web_app\\chrome\\"
</span>
_thisScript = _rootDir + <span class="str">"PF_common.sikuli"</span>

_commonDashDir = _thisScript + <span class="str">"\\config_dash\\"</span>
_dirMap = {<span class="str">"dir"</span>:_commonDashDir}
_config_file= _commonDashDir + <span class="str">"config.txt"</span>

<span class="kw">if</span> os.path.isfile(_chrome_appx86):
    <span class="cmt">#check for x86 path (x64 bit) 
</span>    _chrome_app = _chrome_appx86

_chrome_app = _chrome_app + <span class="str">" --start-maximized"</span>

_config=ConfigParser.ConfigParser(_dirMap)
_config.read(_config_file)
_email = _config.get(<span class="str">'Test_account'</span>, <span class="str">'email1'</span>)
_password = _config.get(<span class="str">'Test_account'</span>, <span class="str">'pass1'</span>)
<span class="cmt">#_email="aleoshina@gmail.com"
</span><span class="cmt">#_password="leoshinaA"
</span>
<span class="cmt">#Clear chrome browser history Data finction. Clear a browser history through browsers hot keys
</span><span class="kw">def</span> ClearBrowsingData():
    time=_config.get(<span class="str">'Delete_history'</span>, <span class="str">'screen1'</span>)
    begin=_config.get(<span class="str">'Delete_history'</span>, <span class="str">'screen2'</span>)
    begin1=_config.get(<span class="str">'Delete_history'</span>, <span class="str">'screen3'</span>)
    load_browser_with_url(<span class="str">" "</span>)
    <span class="skw">sleep</span>(<span class="dig">2</span>)
    <span class="skw">type</span>(<span class="str">"l"</span>, KEY_CTRL)
    <span class="skw">type</span>(<span class="str">"chrome://history\n"</span>)<span class="cmt">#Num Lock keyboard should be disabled </span>
    wait_click(<img src="1386356581840.png" />)
    <span class="kw">if</span> wait_find(begin):
        <span class="skw">type</span>(Key.ENTER)
    <span class="kw">else</span>:
        wait_click(time)
        <span class="skw">sleep</span>(<span class="dig">2</span>)
        <span class="skw">click</span>(begin1)
        <span class="skw">sleep</span>(<span class="dig">2</span>)
        <span class="skw">type</span>(Key.TAB)
        <span class="skw">type</span>(Key.ENTER)
    <span class="skw">sleep</span>(<span class="dig">2</span>)
    <span class="cmt">#type(Key.F4, KeyModifier.ALT)
</span>

<span class="cmt">#remove extension function.
</span><span class="kw">def</span> RemoveExt(logfile):
    <span class="kw">if</span> <span class="kw">not</span> exists(_ch1) <span class="kw">and</span> <span class="kw">not</span> exists(_ch2):
        App.open(_chrome_app)
        wait_find(_ch2)
    <span class="cmt">#config=ConfigParser.ConfigParser()
</span>    <span class="cmt">#config.read(config_file)
</span>    PF_icon = _config.get(<span class="str">'Uninstall'</span>, <span class="str">"button1"</span>)
    PF_icon_settings = _config.get(<span class="str">'Uninstall'</span>, <span class="str">"button2"</span>)
    <span class="skw">sleep</span>(<span class="dig">3</span>)
    <span class="kw">if</span> exists(PF_icon):
        <span class="skw">type</span>(<span class="str">"t"</span>, KeyModifier.CTRL)
        <span class="skw">rightClick</span>(PF_icon)
        <span class="skw">sleep</span>(<span class="dig">1</span>)
        <span class="skw">type</span>(<span class="str">"r"</span>)
        <span class="skw">sleep</span>(<span class="dig">2</span>)
        <span class="skw">type</span>(Key.LEFT)
        <span class="skw">type</span>(Key.ENTER)
        write_log(logfile,<span class="str">"\n&lt;p&gt;Extension was remowed&lt;/p&gt;\n"</span>)
    <span class="kw">else</span>:
        write_log(logfile, <span class="str">"PF already removed!"</span>)
        <span class="kw">return</span>
    write_log(logfile, <span class="str">"&lt;p&gt;extension removed successfully&lt;/p&gt;\n"</span>)

<span class="cmt">#Install extension function. Take a install_link variable defined earlier and pass as argument
</span><span class="kw">def</span> InstallExtension(logfile):
    start_time=datetime.now()
    write_log(logfile, <span class="str">"start installation. Detecting chrome browser..."</span>)

    <span class="kw">if</span> <span class="kw">not</span> exists(_ch1) <span class="kw">and</span> <span class="kw">not</span> exists(_ch2): App.open(_chrome_app)

    write_log(logfile, <span class="str">"Finished detecting chrome browser..."</span>)

    PF_icon=Pattern(<img src="1386656905238.png" />).similar(<span class="dig">0.90</span>)

    <span class="kw">if</span> exists(PF_icon):
        <span class="kw">print</span> <span class="str">"PF is already installed!"</span>
        write_log(logfile, <span class="str">"PF is already installed!"</span>)
        <span class="kw">return</span>

    load_browser_with_url(_install_link)
    cert_warning = _config.get(<span class="str">'Facebook_Login'</span>, <span class="str">"cert_warning"</span>)
    proceed = _config.get(<span class="str">'Facebook_Login'</span>, <span class="str">"proceed"</span>)
    <span class="kw">print</span> <span class="str">"sections: "</span> + str(_config.sections()[<span class="dig">0</span>])
    a=_config.get(<span class="str">'Installation_check'</span>, <span class="str">'screen1'</span>)
    items=len(_config.items(<span class="str">'Installation_check'</span>))
    <span class="kw">print</span> <span class="str">"a is: "</span>, str(a)

    i=<span class="dig">1</span>
    <span class="kw">print</span> <span class="str">"items is: "</span>, items
    <span class="kw">while</span> (i &lt; items):
        <span class="kw">print</span> <span class="str">"i is: "</span>, i

        screen=_config.get(<span class="str">'Installation_check'</span>, <span class="str">'screen'</span>+str(i))

        verify(logfile,screen)
        <span class="skw">click</span>(screen)
        <span class="kw">if</span> exists(cert_warning):
            <span class="skw">click</span>(proceed)
        i+=<span class="dig">1</span>
    <span class="skw">sleep</span>(<span class="dig">2</span>)
    ClearBrowsingData()
    write_log(logfile, <span class="str">"&lt;p&gt;extension installed successfully&lt;/p&gt;\n"</span>)
    write_log(logfile, <span class="str">"Total time for installation is: "</span> + str(datetime.now()-start_time))

<span class="kw">def</span> locate_linkedIn_section(logfile):
    <span class="cmt">#load_browser_with_url(_PF_link)
</span>    <span class="skw">type</span>(Key.HOME)
    <span class="kw">if</span> <span class="kw">not</span> exists(_PF_logo):
        load_browser_with_url(_PF_link)
        wait_find(_PF_logo)

    linkedIn_section_img =_config.get(<span class="str">'Google_Login'</span>, <span class="str">'linkedIn_section_img'</span>)
    google_section_img=_config.get(<span class="str">'Google_Login'</span>, <span class="str">'google_section_img'</span>)
    <span class="cmt">#print "LinkedIn image: " + linkedIn_section_img
</span>    locate_item_page_by_page(logfile, linkedIn_section_img)
    <span class="skw">sleep</span>(<span class="dig">1</span>)
    locate_item_line_by_line(logfile, google_section_img)
    mouseMove(Location(<span class="dig">200</span>,<span class="dig">10</span>))

<span class="cmt">#find google section image, and use down key to find Tracking section image
</span><span class="cmt">#This is to make sure the whole google section is completely showing on screen
</span><span class="kw">def</span> locate_google_section(logfile):
 <span class="cmt">#   load_browser_with_url(_PF_link)
</span>    <span class="skw">type</span>(Key.HOME)
    <span class="skw">sleep</span>(<span class="dig">1</span>)
    <span class="kw">if</span> <span class="kw">not</span> exists(_PF_logo):
        load_browser_with_url(_PF_link)
        wait_find(_PF_logo)
    <span class="cmt">#google_section_img=_config.get('Google_Login', 'google_section_img')
</span>    <span class="cmt">#tracking_section_img=_config.get('Google_Login', 'tracking_section_img')
</span>    <span class="cmt">#print "Google section img: " + google_section_img
</span>    <span class="cmt">#print "tracking section img: " + tracking_section_img
</span>    <span class="cmt">#locate_item_page_by_page(logfile, google_section_img)
</span>    <span class="cmt">#sleep(1)
</span>    <span class="cmt">#locate_item_line_by_line(logfile,tracking_section_img)
</span>    <span class="skw">type</span>(Key.END)
    <span class="skw">type</span>(Key.PAGE_UP)
    <span class="skw">type</span>(Key.PAGE_UP)
    mouseMove(Location(<span class="dig">200</span>,<span class="dig">10</span>))

<span class="kw">def</span> locate_tracking_section(logfile):
    <span class="skw">type</span>(Key.HOME)
    <span class="kw">if</span> <span class="kw">not</span> exists(_PF_logo):
        load_browser_with_url(_PF_link)
        wait_find(_PF_logo)
    <span class="skw">type</span>(Key.END)
    <span class="cmt">#websites_section_end =_config.get('Google_Login', 'websites_section_img_2')
</span>   <span class="cmt"># verify(logfile,websites_section_end)
</span>    <span class="skw">type</span>(Key.PAGE_UP)
    mouseMove(Location(<span class="dig">200</span>,<span class="dig">10</span>))


<span class="kw">def</span> locate_websites_section(logfile):
    <span class="skw">type</span>(Key.HOME)
    <span class="kw">if</span> <span class="kw">not</span> exists(_PF_logo):
        load_browser_with_url(_PF_link)
        wait_find(_PF_logo)
    <span class="skw">type</span>(Key.END)
    <span class="skw">type</span>(Key.PAGE_UP)
    <span class="skw">type</span>(Key.DOWN)
    <span class="skw">type</span>(Key.DOWN)
    mouseMove(Location(<span class="dig">200</span>,<span class="dig">10</span>))
   <span class="cmt"># websites_section_img =_config.get('Google_Login', 'websites_section_img')
</span>   <span class="cmt"># websites_section_img_2 =_config.get('Google_Login', 'websites_section_img_2')
</span>    <span class="cmt">#print "Websites section image: " + websites_section_img_2
</span>    <span class="cmt">#locate_item_page_by_page(logfile, websites_section_img)
</span>    <span class="cmt">#sleep(1)
</span>
 <span class="cmt">#   locate_item_line_by_line(logfile, websites_section_img_2)   
</span>

<span class="cmt">#Login to google account
</span><span class="kw">def</span> GoogleLogin(logfile):
    start_time=datetime.now()
    <span class="skw">type</span>(Key.HOME)
    write_log(logfile, <span class="str">"detecting browser..."</span>)
    <span class="kw">if</span> <span class="kw">not</span> exists(_PF_logo):
        load_browser_with_url(_PF_link)
        wait_find(_PF_logo)
    write_log(logfile, <span class="str">"total time detecting browser is: "</span> + str(datetime.now()-start_time))


    locate_google_section(logfile)

    google_login=(<img src="1387304206285.png" />)

    <span class="kw">if</span> exists(google_login):
        load_browser_with_url(<span class="str">"https://accounts.google.com"</span>)
        <span class="skw">sleep</span>(<span class="dig">2</span>)
        <span class="kw">if</span> exists(Pattern(<img src="1387572416970.png" />).similar(<span class="dig">0.90</span>)):
            <span class="skw">type</span>(_email)
            <span class="skw">sleep</span>(<span class="dig">1</span>)
            <span class="skw">type</span>(Key.TAB)
        <span class="skw">type</span>(_password)
        <span class="skw">sleep</span>(<span class="dig">1</span>)
        <span class="skw">type</span>(Key.ENTER)
        <span class="skw">sleep</span>(<span class="dig">2</span>)
        verify(logfile,<img src="1388176974274.png" />)
        write_log(logfile, <span class="str">"logged into Google successfully\n"</span>)
        write_log(logfile, <span class="str">"Total time for Google login is: "</span> + str(datetime.now()-start_time))
        load_browser_with_url(_PF_link)
        wait_find(_PF_logo)
        locate_google_section(logfile)
        write_log(logfile,<span class="str">"logged into Google successfully\n"</span>)
        mouseMove(Location(<span class="dig">200</span>,<span class="dig">10</span>))

    <span class="kw">else</span>:
        write_log(logfile, <span class="str">"Already logged into Google!\n"</span>)
        <span class="kw">print</span> <span class="str">"Already logged into Google!\n"</span>
        write_log(logfile, <span class="str">"Total time for Google login is: "</span> + str(datetime.now()-start_time))
        mouseMove(Location(<span class="dig">200</span>,<span class="dig">10</span>))

<span class="cmt">#Logging to Facebook
</span><span class="kw">def</span> FacebookLogin(logfile):

    start_time=datetime.now()

    <span class="skw">type</span>(Key.HOME)

    <span class="kw">if</span> <span class="kw">not</span> exists(_PF_logo):
        load_browser_with_url(_PF_link)
        wait_find(_PF_logo)
    write_log(logfile, <span class="str">"total time detecting browser is: "</span> + str(datetime.now()-start_time))

    logged = _config.get(<span class="str">'Facebook_Login'</span>, <span class="str">"logged"</span>)
    loginbutton = _config.get(<span class="str">'Facebook_Login'</span>, <span class="str">"loginbutton"</span>)
    fb_logged_in_icon=_config.get(<span class="str">'Facebook_Login'</span>, <span class="str">"fb_logged_in_icon"</span>)

    <span class="cmt">#if in Facebook section, and login button is not there, then it's logged in.
</span>    <span class="kw">if</span>  verify_continue(logfile,fb_logged_in_icon)==<span class="dig">1</span>:
        write_log(logfile, <span class="str">"Facebook is already logged in!"</span>)
        mouseMove(Location(<span class="dig">200</span>,<span class="dig">10</span>))
        <span class="kw">return</span>
    <span class="cmt">#if login button shown in facebook section, then login to facebook section
</span>    fb_logo = _config.get(<span class="str">'Facebook_Login'</span>, <span class="str">"FB_logo"</span>)
    cert_warning = _config.get(<span class="str">'Facebook_Login'</span>, <span class="str">"cert_warning"</span>)
    proceed = _config.get(<span class="str">'Facebook_Login'</span>, <span class="str">"proceed"</span>)
    verify(logfile,loginbutton)
    <span class="skw">click</span>(Pattern(loginbutton).similar(<span class="dig">0.90</span>))
    <span class="skw">sleep</span>(<span class="dig">2</span>)
    ok_button=(<img src="1388298867679.png" />)

    <span class="kw">if</span> exists(ok_button):
        <span class="skw">click</span>(ok_button)
        wait_click(ok_button)

    wait_find(fb_logo)
    <span class="kw">if</span> exists(Pattern(<img src="1387572170616.png" />).similar(<span class="dig">0.95</span>)) <span class="kw">or</span> exists(Pattern(<img src="1388377018768.png" />).similar(<span class="dig">0.95</span>)):
        <span class="skw">type</span>(_email)
        <span class="skw">sleep</span>(<span class="dig">1</span>)
        <span class="skw">type</span>(Key.TAB)
    <span class="skw">type</span>(_password)
    <span class="skw">sleep</span>(<span class="dig">1</span>)
    <span class="skw">type</span>(Key.ENTER)
    <span class="skw">sleep</span>(<span class="dig">5</span>)
    <span class="kw">if</span> exists(ok_button):
        <span class="skw">click</span>(ok_button)
        wait_click(ok_button)


    verify(logfile,fb_logged_in_icon)
    write_log(logfile, <span class="str">"Logged into Facebook successfully!"</span>)

    <span class="kw">if</span> exists(cert_warning):
        <span class="skw">click</span>(proceed)
    write_log(logfile, <span class="str">"Total Facebook login time is: "</span> + str(datetime.now()-start_time))

<span class="kw">def</span> LinkedInLogIn(logfile):

    start_time=datetime.now()
    <span class="skw">type</span>(Key.HOME)
    <span class="kw">if</span> <span class="kw">not</span> exists(_PF_logo):
        load_browser_with_url(_PF_link)
        wait_find(_PF_logo)

    write_log(logfile, <span class="str">"total time detecting browser is: "</span> + str(datetime.now()-start_time))

    logged_in_linkedIn = _config.get(<span class="str">'LinkedIn_check'</span>, <span class="str">'logged_in_linkedIn'</span>)
    loginbutton = _config.get(<span class="str">'LinkedIn_check'</span>, <span class="str">'screen1'</span>)
    linkedin_section_img=_config.get(<span class="str">'LinkedIn_check'</span>, <span class="str">'linkedin_section_img'</span>)
    linkedIn_profile=_config.get(<span class="str">'LinkedIn_check'</span>, <span class="str">'linkedIn_profile'</span>)

    <span class="cmt">#look for LinkedIn section image to locate LinkedIn section
</span>    locate_linkedIn_section(logfile)

    <span class="cmt">#if profile image exists, it means linkedin is logged in already
</span>    <span class="kw">if</span> exists(linkedIn_profile):
        write_log_with_screenshot(logfile, <span class="str">"Already logged in LinkedIn!"</span>)
        mouseMove(Location(<span class="dig">200</span>,<span class="dig">10</span>))
        <span class="kw">return</span>

    verify(logfile, loginbutton)
    <span class="skw">click</span> (Pattern(loginbutton).similar(<span class="dig">0.70</span>).targetOffset(<span class="dig">223</span>,<span class="dig">4</span>))
    <span class="skw">sleep</span>(<span class="dig">5</span>)
    <span class="kw">if</span> exists(<img src="1387572272054.png" />):
        <span class="skw">type</span>(_email)
        <span class="skw">sleep</span>(<span class="dig">1</span>)
        <span class="skw">type</span>(Key.TAB)
    <span class="skw">type</span>(_password)
    <span class="skw">type</span>(Key.ENTER)
    <span class="skw">sleep</span>(<span class="dig">3</span>)

    verify(logfile,logged_in_linkedIn)
    write_log(logfile, <span class="str">"logged into LinkedIn successfully"</span>)
    write_log(logfile, <span class="str">"Total LinkedIn login time is: "</span> + str(datetime.now()-start_time))
    <span class="cmt">#close the logged in tab, suppose to close by itself. it's a bug right now, if fixed in the future, please delete this line
</span>    <span class="skw">type</span>(<span class="str">'w'</span>, Key.CTRL)
    locate_linkedIn_section(logfile)
    mouseMove(Location(<span class="dig">200</span>,<span class="dig">10</span>))


<span class="kw">def</span> write_log(logfile,msg):
    <span class="cmt">#fo=open(logfile, "a")
</span>    <span class="kw">with</span> open(logfile, <span class="str">'a+'</span>) <span class="kw">as</span> fo:
        fo.write(<span class="str">"\n&lt;p&gt; "</span> + str(datetime.now())+ <span class="str">":   "</span> + msg + <span class="str">" &lt;/p&gt;\n"</span>)


<span class="kw">def</span> write_log_with_screenshot(logfile,msg):
    write_log(logfile,msg)
    scr_shot=<span class="skw">capture</span>(<span class="dig">0</span>,<span class="dig">0</span>,<span class="dig">1400</span>,<span class="dig">900</span>)
    write_screenshot_log(logfile,scr_shot)

<span class="kw">def</span> write_img_log(logfile, img):
<span class="cmt">#    fo=open(logfile, "a")
</span>    <span class="kw">with</span> open(logfile, <span class="str">'a+'</span>) <span class="kw">as</span> fo:
        <span class="kw">print</span> <span class="str">"img path: "</span> +img
    <span class="cmt">#if the img is from common, do not use split
</span>    <span class="cmt">#if img is under xxx.sikuli, it only has the file name, doesn't have path, need to add the test case folder path to it.
</span>    <span class="cmt">#if img is from PF_common, it comes a full path, no need to use split.
</span>        <span class="kw">if</span> <span class="str">"common.sikuli"</span> <span class="kw">in</span> img <span class="kw">and</span> <span class="kw">not</span> <span class="str">"\\"</span> <span class="kw">in</span> img:
            img=<span class="str">"C:\\Automation_PF\\PF_common\\"</span> + img
        <span class="kw">if</span> <span class="kw">not</span> <span class="str">"\\"</span> <span class="kw">in</span> img:
            img_path,img_name=os.path.split(logfile)
            img_path,img_name=os.path.split(img_path)
            msg=<span class="str">'\n&lt;img border=\"0" src="'</span> + img_path+<span class="str">"\\"</span>+ img + <span class="str">'"&gt;&lt;/img&gt;\n'</span>
        <span class="kw">else</span>:msg=<span class="str">'\n&lt;img border=\"0" src="'</span> + img + <span class="str">'"&gt;&lt;/img&gt;\n'</span>
        <span class="kw">print</span> <span class="str">"log image: "</span>, msg
        fo.write(msg)


<span class="kw">def</span> write_screenshot_log(logfile, img):
<span class="cmt">#    fo=open(logfile, "a+")
</span>    <span class="kw">with</span> open(logfile, <span class="str">'a+'</span>) <span class="kw">as</span> fo:
        <span class="kw">print</span> <span class="str">"Image path is: "</span> + img
        img_path,img_name=os.path.split(logfile)
        cmd = <span class="str">"copy %s %s"</span> % (img, img_path)
        os.system(cmd)
        path1,img_name=os.path.split(str(img))

        img= img_path +<span class="str">"\\"</span>+ img_name
        <span class="kw">print</span> <span class="str">"Image path after copy is: "</span> + img
        msg = <span class="str">'&lt;p&gt;Screen shot during test is &lt;a href=file:///'</span> + img + <span class="str">'&gt;here&lt;/a&gt;&lt;/p&gt;'</span>
        <span class="kw">print</span> <span class="str">"Screenshot msg in screenshot log    is:     "</span> + msg
        fo.write(msg)
        <span class="cmt">#write_log(logfile, "message of the link is: " + msg\n")
</span>        <span class="cmt">#msg='\n&lt;img border=\"0" src="' + img + '" width="1200" height="800"&gt;&lt;/img&gt;\n'
</span>
<span class="kw">def</span> cleanTestScript(testScript):
    <span class="kw">if</span> <span class="str">".py.sikuli"</span> <span class="kw">in</span> testScript:
        testScript = testScript.replace(<span class="str">".py.sikuli"</span>, <span class="str">".sikuli"</span>)
    <span class="kw">return</span> testScript


<span class="kw">def</span> create_log_folder(testScript,testCase):
    log_path=_rootDir + cleanTestScript(testScript)+ <span class="str">"\\log\\"</span>
    log_file= log_path +str(testCase)+ <span class="str">"-log.html"</span>
    <span class="kw">print</span> log_path
    cmd = <span class="str">"mkdir %s"</span> % (log_path)
    <span class="kw">print</span> <span class="str">"log path created:  "</span> + log_path
    os.system(cmd)
    <span class="kw">return</span> log_file

<span class="kw">def</span> wait_find(y):
    i=<span class="dig">0</span>
    <span class="kw">while</span> (<span class="kw">not</span> exists(y)<span class="kw">and</span> i&lt;<span class="dig">5</span>):
        <span class="skw">sleep</span>(<span class="dig">2</span>)
        i+=<span class="dig">1</span>
    <span class="kw">if</span> exists(y):
        <span class="kw">return</span> <span class="dig">1</span>
    <span class="kw">else</span>: <span class="kw">return</span> <span class="dig">0</span>

<span class="kw">def</span> wait_click(y):
    i=<span class="dig">0</span>
    <span class="kw">while</span> (i&lt;<span class="dig">5</span>):
        <span class="skw">sleep</span>(<span class="dig">2</span>)
        i+=<span class="dig">1</span>
    <span class="kw">if</span> exists(y):
        <span class="skw">click</span>(y)
        <span class="kw">return</span> <span class="dig">1</span>
    <span class="kw">else</span>: <span class="kw">return</span> <span class="dig">0</span>

<span class="kw">def</span> verify_continue(logfile,image):
    x = wait_find(Pattern(image).similar(<span class="dig">0.90</span>))
    screen_shot=<span class="skw">capture</span>(<span class="dig">0</span>,<span class="dig">0</span>,<span class="dig">1440</span>,<span class="dig">900</span>)
    <span class="kw">if</span> x==<span class="dig">1</span>:
        write_log(logfile,<span class="str">"Following expected image was found:\n"</span>)
        write_img_log(logfile,str(image))
        write_screenshot_log(logfile,screen_shot)
        <span class="kw">return</span> <span class="dig">1</span>
    <span class="kw">else</span>:
        write_log(logfile,<span class="str">"Not able to find following image:\n"</span>)
        write_img_log(logfile, str(image))
        write_screenshot_log(logfile,str(screen_shot))
        <span class="kw">return</span> <span class="dig">0</span>

<span class="kw">def</span> verify(logfile,image):
    x = wait_find(Pattern(image).similar(<span class="dig">0.80</span>))
    screen_shot=<span class="skw">capture</span>(<span class="dig">0</span>,<span class="dig">0</span>,<span class="dig">1440</span>,<span class="dig">900</span>)
    <span class="kw">if</span> x==<span class="dig">1</span>:
        write_log(logfile,<span class="str">"Following expected image was found:\n"</span>)
        write_img_log(logfile,str(image))
        write_screenshot_log(logfile,screen_shot)

    <span class="kw">else</span>:
        write_log(logfile,<span class="str">"Not able to find following image:\n"</span>)
        write_img_log(logfile, str(image))
        write_screenshot_log(logfile,str(screen_shot))
        <span class="kw">raise</span> Exception(<span class="str">"Not able to find image "</span> + str(image))

<span class="kw">def</span> verify_exactly(logfile,image):
    x = wait_find(Pattern(image).similar(<span class="dig">0.99</span>))
    screen_shot=<span class="skw">capture</span>(<span class="dig">0</span>,<span class="dig">0</span>,<span class="dig">1440</span>,<span class="dig">900</span>)
    <span class="kw">if</span> x==<span class="dig">1</span>:
        write_log(logfile,<span class="str">"Following expected image was found:\n"</span>)
        write_img_log(logfile,str(image))
        write_screenshot_log(logfile,screen_shot)
    <span class="kw">else</span>:
        write_log(logfile,<span class="str">"Not able to find following image:\n"</span>)
        write_img_log(logfile, str(image))
        write_screenshot_log(logfile,str(screen_shot))
        <span class="kw">raise</span> Exception(<span class="str">"Not able to find image "</span> + str(image))

<span class="kw">def</span> load_browser_with_url(link):
    <span class="kw">if</span> <span class="kw">not</span> exists(_ch1) <span class="kw">and</span> <span class="kw">not</span> exists(_ch2):
        App.open(_chrome_app)
        wait_find(_ch2)
        mouseMove(Location(<span class="dig">200</span>,<span class="dig">10</span>))
    switchApp(<span class="str">"Google Chrome"</span>)
    <span class="skw">sleep</span>(<span class="dig">2</span>)
    <span class="skw">type</span>(<span class="str">'l'</span>, KEY_CTRL)
    <span class="skw">type</span>(link+<span class="str">"\n"</span>)
    <span class="skw">sleep</span>(<span class="dig">5</span>)
    mouseMove(Location(<span class="dig">200</span>,<span class="dig">10</span>))

<span class="kw">def</span> load_browser_with_url_firefox(link):
    App.open(<span class="str">"C:\Program Files (x86)\Mozilla Firefox\firefox.exe"</span>)
    <span class="skw">type</span>(<span class="str">'D'</span>, Key.ALT)
    <span class="skw">type</span>(link+<span class="str">"\n"</span>)
    <span class="skw">sleep</span>(<span class="dig">5</span>)
    mouseMove(Location(<span class="dig">200</span>,<span class="dig">10</span>))

<span class="kw">def</span> locate_item_line_by_line(logfile,img):
    i=<span class="dig">0</span>
    k=<span class="dig">0</span>
    <span class="kw">while</span> (<span class="kw">not</span> exists(img) <span class="kw">and</span> i&lt;<span class="dig">9</span>):
        <span class="skw">type</span>(Key.DOWN)
        <span class="skw">type</span>(Key.DOWN)
        <span class="skw">type</span>(Key.DOWN)
        mouseMove(Location(<span class="dig">200</span>,<span class="dig">10</span>))
        i+=<span class="dig">1</span>
    <span class="kw">if</span> exists(img):
        write_log(logfile, <span class="str">"Locate image in locate_item_line_by_line, image found: "</span> +img)
        write_img_log(logfile, img)
        write_log_with_screenshot(logfile,<span class="str">"See Screenshot:"</span>)
        k=<span class="dig">1</span>
    <span class="kw">else</span>:
        write_log(logfile, <span class="str">"Locate image in locate_item_line_by_line, not able to find image: "</span> +img)
        write_img_log(logfile, img)
        write_log_with_screenshot(logfile,<span class="str">"See Screenshot:"</span>)
        <span class="kw">raise</span> Exception(<span class="str">"Locate_item_line_by_line Exception: Not able to locate image: "</span> + img)

<span class="kw">def</span> locate_item_page_by_page(logfile,img):
    i=<span class="dig">0</span>
    <span class="kw">while</span> (<span class="kw">not</span> exists(img) <span class="kw">and</span> i&lt;<span class="dig">4</span>):
        <span class="skw">type</span>(Key.PAGE_DOWN)
        mouseMove(Location(<span class="dig">200</span>,<span class="dig">10</span>))
        i+=<span class="dig">1</span>
        <span class="skw">sleep</span>(<span class="dig">3</span>)
    <span class="kw">if</span> exists(img):
        write_log(logfile, <span class="str">"Locate image in locate_item_line_by_line, image found: "</span> +img)
        write_img_log(logfile, img)
        write_log_with_screenshot(logfile,<span class="str">"See Screenshot:"</span>)
        k=<span class="dig">1</span>
    <span class="kw">else</span>:
        write_log(logfile, <span class="str">"Locate image in locate_item_line_by_line, not able to find image: "</span> +img)
        write_img_log(logfile, img)
        write_log_with_screenshot(logfile,<span class="str">"See Screenshot:"</span>)



<span class="kw">def</span> get_img_value(image,text):
    wait_click(<img src="1388032151500.png" />)

    <span class="skw">type</span>(Key.F12)
    wait_click(<img src="1388032189908.png" />)

    <span class="skw">type</span>(<span class="str">"f"</span>, Key.CTRL)
    <span class="skw">sleep</span>(<span class="dig">3</span>)
    <span class="skw">type</span>(text)
    <span class="skw">sleep</span>(<span class="dig">3</span>)
    <span class="skw">type</span>(Key.ENTER)

    <span class="kw">if</span> exists(image):
        <span class="skw">click</span>(image)
        <span class="skw">type</span>(<span class="str">"c"</span>, KEY_CTRL)
        <span class="kw">print</span> <span class="str">"CTRL_C pressed!"</span>
        <span class="skw">sleep</span>(<span class="dig">2</span>)
        <span class="cmt">#App.open("%windir%\system32\notepad.exe")
</span>        <span class="skw">sleep</span>(<span class="dig">3</span>)
        <span class="skw">type</span>(<span class="str">"v"</span>, Key.CTRL)
        data=Env.getClipboard()
        <span class="kw">print</span> <span class="str">"txt: "</span> + str(data)
        value1=(data.split(<span class="str">'&gt;'</span>)[<span class="dig">1</span>]).split(<span class="str">'&lt;'</span>)[<span class="dig">0</span>]
        value1=int(value1.replace(<span class="str">'%'</span>,<span class="str">''</span>))
        <span class="skw">type</span>(Key.F12)
        <span class="kw">print</span> value1
        <span class="kw">return</span> value1

    <span class="kw">else</span> : <span class="kw">print</span> <span class="str">"fail"</span>

<span class="kw">def</span> get_protection_value(logfile):

    search_txt1=<img src="search_txt1_img.png" />

    <span class="cmt">#search_txt2="1386700206064-1.png"
</span>
    <span class="cmt">#search_txt1= "1387454285798.png"
</span>
    switchApp(<span class="str">"Google Chrome"</span>)
    <span class="cmt">#search_str2="num_private_settings\n"
</span>    search_str1=<span class="str">"fb_protection_percent\n"</span>
    <span class="kw">print</span> <span class="str">"search img: "</span> +str(search_txt1)
    percent_value = get_img_value(search_txt1, search_str1)
    <span class="cmt">#list2 = get_img_value(search_txt2,search_str2)
</span>    <span class="cmt">#print percent_value
</span>    write_log(logfile,<span class="str">"Protection value is:"</span> + str(percent_value))
    screen_shot=<span class="skw">capture</span>(<span class="dig">0</span>,<span class="dig">0</span>,<span class="dig">1440</span>,<span class="dig">900</span>)
    write_screenshot_log(logfile,screen_shot)
    <span class="kw">return</span> percent_value


<span class="kw">def</span> testScriptPaths():
     <span class="kw">print</span> <span class="str">"_rootDir= "</span>, _rootDir, <span class="str">"\n_thisScript= "</span>, _thisScript, <span class="str">"\n_commonDashDir= "</span>, _commonDashDir, <span class="str">"\n_config_file= "</span>, _config_file
     <span class="kw">print</span> _config.get(<span class="str">'Delete_history'</span>, <span class="str">'screen1'</span>)


<span class="kw">def</span> PassCase(log_file, test_case_id):
    <span class="skw">type</span>(<span class="str">"l"</span>, KEY_CTRL)
    <span class="skw">type</span>(_passed_link +<span class="str">"\n"</span>)
    <span class="skw">sleep</span>(<span class="dig">5</span>)
    msg=str(test_case_id) +<span class="str">' Test Case Passed!'</span>
    write_log (log_file,msg)
    msg=<span class="str">"Tested URL:"</span> + _PF_link
    write_log(log_file,msg)

<span class="kw">def</span> FailTestCase(logfile, test_case_id):
    <span class="skw">type</span>(<span class="str">"l"</span>, KEY_CTRL)
    <span class="skw">type</span>(_failed_link)
    <span class="skw">type</span>(Key.ENTER)
    write_log (logfile, test_case_id + <span class="str">' Test Case failed!'</span>)
    msg=<span class="str">"Tested URL:"</span> + _PF_link
    write_log(logfile,msg)

<span class="kw">def</span> get_img_value_firefox(image):
    <span class="skw">sleep</span>(<span class="dig">6</span>)
    <span class="skw">type</span>(Key.F12)
    <span class="cmt">#sleep(6)
</span>    wait_click(<img src="1388481656140.png" />)
    wait_click(<img src="1388481667291.png" />)
    wait_click(<img src="1388481681375.png" />)
    <span class="skw">sleep</span>(<span class="dig">3</span>)

    <span class="kw">if</span> exists(image):
        <span class="skw">click</span>(image)
        <span class="skw">sleep</span>(<span class="dig">2</span>)
        <span class="skw">type</span>(Key.RIGHT)
        <span class="skw">type</span>(Key.DOWN)
        <span class="skw">type</span>(Key.ENTER)
        <span class="skw">type</span>(<span class="str">"c"</span>, KEY_CTRL)
        <span class="kw">print</span> <span class="str">"CTRL_C pressed!"</span>
        <span class="skw">sleep</span>(<span class="dig">2</span>)
        <span class="cmt">#App.open("%windir%\system32\notepad.exe")
</span>        <span class="skw">sleep</span>(<span class="dig">3</span>)
        <span class="skw">type</span>(<span class="str">"v"</span>, Key.CTRL)
        data=Env.getClipboard()
        <span class="kw">print</span> <span class="str">"txt: "</span> + str(data)
        value1=int(data.replace(<span class="str">'%'</span>,<span class="str">''</span>))
        <span class="skw">type</span>(Key.F12)
        <span class="kw">print</span> value1
        <span class="kw">return</span> value1

    <span class="kw">else</span> : <span class="kw">print</span> <span class="str">"fail"</span>

<span class="kw">def</span> get_protection_value_firefox(logfile):

    search_txt1=<img src="1388482910074.png" />

    switchApp(<span class="str">"Firefox"</span>)
    <span class="cmt">#search_str2="num_private_settings\n"
</span>    <span class="cmt">#search_str1="fb_protection_percent\n"
</span>    <span class="kw">print</span> <span class="str">"search img: "</span> +str(search_txt1)
    percent_value = get_img_value_firefox(search_txt1)
    <span class="cmt">#list2 = get_img_value(search_txt2,search_str2)
</span>    <span class="cmt">#print percent_value
</span>    write_log(logfile,<span class="str">"Protection value is:"</span> + str(percent_value))
    screen_shot=<span class="skw">capture</span>(<span class="dig">0</span>,<span class="dig">0</span>,<span class="dig">1350</span>,<span class="dig">850</span>)
    write_screenshot_log(logfile,screen_shot)
    <span class="kw">return</span> percent_value

<span class="kw">if</span> __name__ == <span class="str">"__main__"</span>:
    <span class="cmt"># This runs when executing PF_common directly, it will NOT run when importing.
</span>    <span class="cmt"># if indented (under the if statement, if not indented it will always run.)
</span>    testScriptPaths()
        <span class="cmt">#protection_values()    
</span>        <span class="cmt">#lst=protection_values()        
</span>        <span class="cmt">#print lst[0]
</span>        <span class="cmt">#print lst[1]  
</span>    <span class="cmt">#RemoveExt("C:\Automation_PF\log.html")
</span>        <span class="cmt">#InstallExtension("C:\Automation_PF\log.html")
</span>


        <span class="cmt">#print "say hi from PF_common"
</span>        <span class="cmt">#load_browser_with_url("google.com")
</span>    <span class="cmt">#logfile="C:\\Automation\\log.html"
</span>        <span class="cmt">#write_img_log(logfile, img)
</span>        <span class="cmt">#ClearBrowsingData()
</span>   <span class="cmt"># RemoveExt(logfile)
</span>    <span class="cmt">#InstallExtension(logfile)
</span><span class="cmt">#    write_log_with_screenshot(logfile,"hi, just a test")
</span>    <span class="cmt">#scr=capture(0,0,1400,900)
</span>    <span class="cmt">#write_screenshot_log(logfile,scr)
</span>
    <span class="cmt">#FacebookLogin(logfile)
</span>    <span class="cmt">#LinkedInLogIn(logfile)
</span>    <span class="cmt">#GoogleLogin(logfile)
</span>        <span class="cmt">#locate_google_section(logfile)
</span>        <span class="cmt">#locate_websites_section(logfile)
</span>        <span class="cmt">#locate_linkedIn_section(logfile)
</span>    <span class="cmt">#get_protection_value(logfile)
</span>
    <span class="cmt">#start_time=datetime.now()
</span><span class="cmt">#    logfile="C:\\Automation\\log.html" 
</span>    <span class="cmt">#locate_google_section(logfile)
</span> <span class="cmt">#   locate_tracking_section(logfile)
</span> <span class="cmt">#   locate_websites_section(logfile)
</span>    <span class="cmt">#sleep(3)
</span>    <span class="cmt">#print "Total time for installation is: " + str(datetime.now()-start_time)</span>
</pre>
</body>
</html>
